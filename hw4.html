<!DOCTYPE html>
<html>
<head>
<style>
#info {
	position: absolute;
	top: 0px;
	width: 100%;
	padding: 10px;
	text-align: center;
	color: #8b0000;
}

body {
	overflow: hidden;
}
</style>
</head>
<body>
<div id="info">
	<h1>Homework 4 - Class, Texture Animation, and Picking</h1>
</div>

<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>


<script>
var camera, scene, renderer;
var candle0, flameMesh;

init();
animate();

/*class Candles {

	constructor(positionX, positionZ){
	
	}
	
	
}*/

function makeCandles() {

	var candle = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 15, 32), new THREE.MeshPhongMaterial({
		color: 0xfa8072,
	}));
	candle.position.y = 7.5;
	return candle;
}

function CandleLight() {

  let loader = new THREE.TextureLoader();    // load a resource
  
  loader.load('https://i.imgur.com/sAQQugh.png',
	function(texture) {
		var texMat = new THREE.MeshBasicMaterial({
			map: texture,
			alphaTest:0.5
		});
		flameMesh = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), texMat);
		texture.wrapS = THREE.RepeatWrapping;
		texture.wrapT = THREE.RepeatWrapping;
		texture.repeat.set (1/3,1/3);
		texture.offset.set (0,2/3);
		//scene.add (flameMesh);
		candle0 = makeCandles();
		candle0.add (flameMesh);
		scene.add (candle0);
		flameMesh.position.y = 11;
    },
	undefined,
    function(xhr) {
      console.log('An error happened');
    }
  );
}

function textureAnimate() {

	textureAnimate.count = (textureAnimate.count === undefined) ? 1 : textureAnimate.count;

	if (flameMesh!== undefined) {
		var texture = flameMesh.material.map;
		texture.offset.x += 1/3;
		
		if (textureAnimate.count % 3 === 0) {
			texture.offset.y -= 1/3;
		}
		textureAnimate.count++;
	}
}

function init() {

	renderer = new THREE.WebGLRenderer();
	document.body.appendChild(renderer.domElement);
	var width = window.innerWidth;
	var height = window.innerHeight;
	renderer.setSize(width, height);

	renderer.setClearColor(0xe9967a);

	scene = new THREE.Scene();
	var grid = new THREE.GridHelper(200, 20, 'red', 'white');
	scene.add(grid);
	var axes = new THREE.AxesHelper(5);
	scene.add(axes);

	camera = new THREE.PerspectiveCamera(35, width / height, 1, 10000);
	camera.position.set(200, 10, 0);
	camera.lookAt(new THREE.Vector3(0, 10, 0));
	
	let controls = new THREE.OrbitControls(camera, renderer.domElement);
	
	controls.enableKeys = false;

	window.addEventListener('resize', onWindowResize, false);
	////////////////////////////////////////////////////////////////
	const light = new THREE.PointLight("white", 1.4);
	light.position.set(10, 30, 0);
	scene.add(light);
	
	var ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshPhongMaterial({
		color: 0x8b0000
	}));
	ground.rotation.x = -Math.PI / 2;
	
	candle = new THREE.Mesh(new THREE.CylinderGeometry(2, 2, 15, 32), new THREE.MeshPhongMaterial({
		color: 0xfa8072,
	}));
	candle.position.set(0, 7.5, 0);
	scene.add(ground);
	CandleLight();
	
	flameInterval = setInterval (textureAnimate, 100);
}

function onWindowResize() {

	var width = window.innerWidth;
	var height = window.innerHeight;
	camera.aspect = width / height;
	camera.updateProjectionMatrix();
	renderer.setSize(width, height);
}

function animate() {
	
	requestAnimationFrame(animate);
	render();
	
	candle0.lookAt (camera.position.x, 0, camera.position.z);
}

function render() {

	renderer.render(scene, camera);
}
</script>

</body>
</html>